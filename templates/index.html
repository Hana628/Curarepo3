{% extends 'layout.html' %}

{% block content %}
<div class="jumbotron bg-dark text-light p-5 mb-4 rounded">
    <h1 class="display-4 app-title">MediDiag <small class="text-muted">Medical Diagnostic System</small></h1>
    <p class="lead">
        An intelligent medical diagnostic system that helps you identify diseases based on symptoms and detect skin conditions from images.
    </p>
    <hr class="my-4">
    <p>
        <i class="fas fa-info-circle text-info me-2"></i>
        This tool is designed to assist with preliminary diagnosis. Always consult with a healthcare professional for medical advice.
    </p>
</div>

<div class="row">
    <!-- Disease Prediction Section -->
    <div class="col-lg-6 mb-4" id="disease-section">
        <div class="card bg-dark form-card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-stethoscope me-2"></i>
                    Disease Prediction from Symptoms
                </h5>
            </div>
            <div class="card-body">
                <form id="disease-prediction-form" action="{{ url_for('predict_disease') }}" method="post">
                    <div class="mb-3">
                        <label for="symptom-select" class="form-label">Select Your Symptoms</label>
                        <select id="symptom-select" class="form-select mb-2">
                            <option value="">-- Select a symptom --</option>
                            {% for symptom in symptoms %}
                                <option value="{{ symptom }}">{{ symptom }}</option>
                            {% endfor %}
                        </select>
                        
                        <div id="selected-symptoms" class="mt-3 mb-3">
                            {% if selected_symptoms %}
                                {% for symptom in selected_symptoms %}
                                    <div class="badge bg-primary me-2 mb-2 symptom-badge" data-symptom="{{ symptom }}">
                                        {{ symptom }} <span class="badge-close">&times;</span>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        
                        <div id="symptom-input">
                            {% if selected_symptoms %}
                                {% for symptom in selected_symptoms %}
                                    <input type="hidden" name="symptoms" value="{{ symptom }}">
                                {% endfor %}
                            {% endif %}
                        </div>
                        
                        <div id="symptom-count" class="symptom-count">
                            {% if selected_symptoms %}
                                {{ selected_symptoms|length }} symptom(s) selected
                            {% else %}
                                0 symptom(s) selected
                            {% endif %}
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search me-1"></i> Predict Disease
                    </button>
                </form>
                
                <div id="disease-loader" class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Analyzing symptoms...</p>
                </div>
                
                {% if result %}
                <div class="prediction-result bg-dark mt-4 border border-primary">
                    <h4 class="result-header text-primary">Prediction Result</h4>
                    <p>
                        Based on your symptoms, you may have <span class="disease-name">{{ result.disease }}</span>
                        <span class="badge bg-info ms-2">{{ result.confidence }}</span>
                    </p>
                    
                    <h5 class="mt-3">Description</h5>
                    <p>{{ result.description }}</p>
                    
                    <h5 class="mt-3">Precautions</h5>
                    <ul class="precaution-list">
                        {% for precaution in result.precautions %}
                            <li>{{ precaution }}</li>
                        {% endfor %}
                    </ul>
                    
                    <h5 class="mt-3">Specialist Recommendation</h5>
                    <p>You should consult a <span class="specialist-name">{{ result.specialist }}</span> for this condition.</p>
                    
                    <div class="alert alert-warning mt-3">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        This is not a medical diagnosis. Please consult with a healthcare professional.
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Skin Disease Detection Section -->
    <div class="col-lg-6 mb-4" id="skin-section">
        <div class="card bg-dark form-card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fas fa-camera me-2"></i>
                    Skin Disease Detection
                </h5>
            </div>
            <div class="card-body">
                <form id="skin-disease-form" action="{{ url_for('predict_skin_disease') }}" method="post" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="image-upload" class="form-label">Upload an image of the skin condition</label>
                        <input type="file" class="form-control" id="image-upload" name="image" accept="image/png, image/jpeg, image/jpg">
                        <div class="form-text">Supported formats: JPG, JPEG, PNG</div>
                    </div>
                    
                    <div id="image-preview" class="text-center">
                        <!-- Image preview will be displayed here -->
                    </div>
                    
                    <button type="submit" class="btn btn-info mt-3">
                        <i class="fas fa-search me-1"></i> Detect Skin Disease
                    </button>
                </form>
                
                <div id="skin-loader" class="loading-spinner">
                    <div class="spinner-border text-info" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Analyzing image...</p>
                </div>
                
                {% if skin_result %}
                <div class="prediction-result bg-dark mt-4 border border-info">
                    <h4 class="result-header text-info">Skin Disease Detection Result</h4>
                    <p>
                        The detected skin condition is <span class="disease-name">{{ skin_result.class_name }}</span>
                        <span class="badge bg-info ms-2">{{ skin_result.confidence }}</span>
                    </p>
                    
                    <div class="text-center mt-3">
                        <img src="data:image/jpeg;base64,{{ skin_result.image }}" alt="Uploaded skin image" class="uploaded-image">
                    </div>
                    
                    <div class="alert alert-warning mt-3">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        This is not a medical diagnosis. Please consult with a dermatologist or healthcare professional.
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card bg-dark text-light">
            <div class="card-header bg-secondary">
                <h5 class="mb-0">About MediDiag</h5>
            </div>
            <div class="card-body">
                <h5>How It Works</h5>
                <p>
                    MediDiag uses machine learning algorithms to analyze symptoms and images for providing preliminary medical insights:
                </p>
                <ol>
                    <li><strong>Disease Prediction:</strong> Select your symptoms from the dropdown menu, and our system will predict possible diseases based on the symptom patterns.</li>
                    <li><strong>Skin Disease Detection:</strong> Upload an image of a skin condition, and our advanced image recognition system will analyze it to detect potential skin diseases.</li>
                </ol>
                
                <h5 class="mt-4">Disclaimer</h5>
                <p>
                    The predictions and detections provided by this system are not intended to replace professional medical advice, diagnosis, or treatment. 
                    Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
